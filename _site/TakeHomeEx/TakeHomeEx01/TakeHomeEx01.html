<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kieren Chua">
<meta name="dcterms.date" content="2024-08-26">

<title>ISSS626-Kieren Chua - Take Home Exercise 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ISSS626-Kieren Chua</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands On Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../HandsonEx/HandsonEx01/HandsonEx01.html">
 <span class="dropdown-text">Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsonEx/HandsonEx02/HandsonEx02.html">
 <span class="dropdown-text">Exercise 2, Part 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsonEx/HandsonEx02/HandsonEx02_2.html">
 <span class="dropdown-text">Exercise 2, Part 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsonEx/HandsonEx03/HandsOnEx03.html">
 <span class="dropdown-text">Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsonEx/HandsonEx04/HandsonEx04.html">
 <span class="dropdown-text">Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsonEx/HandsonEx05/HandsonEx05.html">
 <span class="dropdown-text">Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsonEx/HandsonEx06/HandsonEx06.html">
 <span class="dropdown-text">Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsonEx/HandsonEx07/HandsonEx07.html">
 <span class="dropdown-text">Exercise 7</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In Class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../InClassEx/InClassEx01/InClassEx01.html">
 <span class="dropdown-text">In Class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/InClassEx03/InClassEx03.html">
 <span class="dropdown-text">In Class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/InClassEx04/InClassEx04.html">
 <span class="dropdown-text">In Class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/InClassEx05/InClassEx05.html">
 <span class="dropdown-text">In Class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/InClassEx06/InClassEx06.html">
 <span class="dropdown-text">In Class Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/InClassEx07/InClassEx07.html">
 <span class="dropdown-text">In Class Exercise 7</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take Home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../TakeHomeEx/TakeHomeEx01/TakeHomeEx01.html">
 <span class="dropdown-text">Take Home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../TakeHomeEx/TakeHomeEx02/TakeHomeEx02.html">
 <span class="dropdown-text">Take Home Exercise 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#take-home-exercise-1" id="toc-take-home-exercise-1" class="nav-link active" data-scroll-target="#take-home-exercise-1">Take Home Exercise 1</a>
  <ul class="collapse">
  <li><a href="#part-1-reading-the-data" id="toc-part-1-reading-the-data" class="nav-link" data-scroll-target="#part-1-reading-the-data">Part 1 : Reading the Data</a></li>
  <li><a href="#part-2-split-by-location" id="toc-part-2-split-by-location" class="nav-link" data-scroll-target="#part-2-split-by-location">Part 2 : Split by location</a></li>
  <li><a href="#part-3-saving-the-smaller-files" id="toc-part-3-saving-the-smaller-files" class="nav-link" data-scroll-target="#part-3-saving-the-smaller-files">Part 3 : Saving the Smaller Files</a></li>
  <li><a href="#part-4-read-the-new-file" id="toc-part-4-read-the-new-file" class="nav-link" data-scroll-target="#part-4-read-the-new-file">Part 4 : Read the new file</a></li>
  <li><a href="#part-4-plot-all-graphs-together-for-visual-prelimnary-analysis" id="toc-part-4-plot-all-graphs-together-for-visual-prelimnary-analysis" class="nav-link" data-scroll-target="#part-4-plot-all-graphs-together-for-visual-prelimnary-analysis">Part 4 : Plot all graphs together for visual prelimnary analysis’</a></li>
  <li><a href="#part-5-1st-and-2nd-order-analysis-of-road-accidents" id="toc-part-5-1st-and-2nd-order-analysis-of-road-accidents" class="nav-link" data-scroll-target="#part-5-1st-and-2nd-order-analysis-of-road-accidents">Part 5 : 1st and 2nd Order Analysis of Road Accidents</a>
  <ul class="collapse">
  <li><a href="#check-1st-order-and-view" id="toc-check-1st-order-and-view" class="nav-link" data-scroll-target="#check-1st-order-and-view">Check 1st Order and View</a></li>
  </ul></li>
  <li><a href="#part-6-check-network-constrained-by-time" id="toc-part-6-check-network-constrained-by-time" class="nav-link" data-scroll-target="#part-6-check-network-constrained-by-time">Part 6 : Check Network constrained by Time</a>
  <ul class="collapse">
  <li><a href="#convert-to-linestring" id="toc-convert-to-linestring" class="nav-link" data-scroll-target="#convert-to-linestring">Convert to LineString</a></li>
  <li><a href="#additional-filtering" id="toc-additional-filtering" class="nav-link" data-scroll-target="#additional-filtering">Additional Filtering</a></li>
  <li><a href="#time-and-size-based-additions" id="toc-time-and-size-based-additions" class="nav-link" data-scroll-target="#time-and-size-based-additions">Time and size based additions</a></li>
  <li><a href="#histogram-analysis" id="toc-histogram-analysis" class="nav-link" data-scroll-target="#histogram-analysis">Histogram Analysis</a></li>
  <li><a href="#finding-bandwidths-using-k-function" id="toc-finding-bandwidths-using-k-function" class="nav-link" data-scroll-target="#finding-bandwidths-using-k-function">Finding bandwidths using K-Function</a></li>
  <li><a href="#lixelize-based-on-bandwidths" id="toc-lixelize-based-on-bandwidths" class="nav-link" data-scroll-target="#lixelize-based-on-bandwidths">Lixelize based on bandwidths</a></li>
  <li><a href="#plot-graphs-by-name" id="toc-plot-graphs-by-name" class="nav-link" data-scroll-target="#plot-graphs-by-name">Plot Graphs By Name</a></li>
  </ul></li>
  <li><a href="#part-7-final-analysis" id="toc-part-7-final-analysis" class="nav-link" data-scroll-target="#part-7-final-analysis">Part 7 : Final Analysis</a></li>
  <li><a href="#part-8-observations" id="toc-part-8-observations" class="nav-link" data-scroll-target="#part-8-observations">Part 8 : Observations</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take Home Exercise 1</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kieren Chua </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 26, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">September 22, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="take-home-exercise-1" class="level1">
<h1>Take Home Exercise 1</h1>
<section id="part-1-reading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="part-1-reading-the-data">Part 1 : Reading the Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(<span class="st">"sf"</span>, <span class="st">"tidyverse"</span>, <span class="st">"tmap"</span>, <span class="st">"ggstatsplot"</span>, <span class="st">"spatstat"</span>, <span class="st">"spNetwork"</span>, <span class="st">"tmaptools"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Import the road accident data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>rdacc_sf <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/thai_road_accident_2019_2022.csv"</span>) <span class="sc">%&gt;%</span> <span class="co"># Read the data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">month</span>(incident_datetime, <span class="at">label=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="co"># Get month, set the date as factor by number</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dayofweek =</span> <span class="fu">day</span>(incident_datetime)) <span class="sc">%&gt;%</span> <span class="co"># Day of the week </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Month_fac =</span> <span class="fu">month</span>(incident_datetime, <span class="at">label =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> <span class="co"># Sort by Factor setting label = FALSE</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(longitude) <span class="sc">&amp;</span> longitude <span class="sc">!=</span> <span class="st">""</span>, <span class="sc">!</span><span class="fu">is.na</span>(latitude) <span class="sc">&amp;</span> latitude <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">%&gt;%</span> <span class="co"># Filter for N.A. and empty values</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs=</span><span class="dv">4326</span>) <span class="sc">%&gt;%</span> <span class="co"># Convert to SF format</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">32647</span>) <span class="co"># Convert to the correct format</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 81735 Columns: 18
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (10): province_th, province_en, agency, route, vehicle_type, presumed_c...
dbl   (6): acc_code, number_of_vehicles_involved, number_of_fatalities, numb...
dttm  (2): incident_datetime, report_datetime

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use 32647 Format because the metro area is here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>View the data, check for data loss <strong>NO MORE THAN 25%</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change to dataframe, check col names </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>rdacc_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(rdacc_sf)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rdacc_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "acc_code"                    "incident_datetime"          
 [3] "report_datetime"             "province_th"                
 [5] "province_en"                 "agency"                     
 [7] "route"                       "vehicle_type"               
 [9] "presumed_cause"              "accident_type"              
[11] "number_of_vehicles_involved" "number_of_fatalities"       
[13] "number_of_injuries"          "weather_condition"          
[15] "road_description"            "slope_description"          
[17] "Month"                       "dayofweek"                  
[19] "Month_fac"                   "geometry"                   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>rdacc_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 81376 features and 19 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -16183190 ymin: -936.228 xmax: 1200243 ymax: 4918525
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 81,376 × 20
   acc_code incident_datetime   report_datetime     province_th province_en     
 *    &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;              &lt;chr&gt;       &lt;chr&gt;           
 1   571905 2019-01-01 00:00:00 2019-01-02 06:11:00 ลพบุรี        Loburi          
 2  3790870 2019-01-01 00:03:00 2020-02-20 13:48:00 อุบลราชธานี   Ubon Ratchathani
 3   599075 2019-01-01 00:05:00 2019-01-01 10:35:00 ประจวบคีรีขันธ์ Prachuap Khiri …
 4   571924 2019-01-01 00:20:00 2019-01-02 05:12:00 เชียงใหม่     Chiang Mai      
 5   599523 2019-01-01 00:25:00 2019-01-04 09:42:00 นครสวรรค์    Nakhon Sawan    
 6   571982 2019-01-01 00:30:00 2019-01-07 12:46:00 แม่ฮ่องสอน    Mae Hong Son    
 7   612782 2019-01-01 00:30:00 2019-10-25 14:25:00 ชุมพร        Chumphon        
 8   599235 2019-01-01 00:35:00 2019-01-02 16:23:00 สิงห์บุรี       Sing Buri       
 9   600643 2019-01-01 00:40:00 2019-01-11 10:01:00 สงขลา       Songkhla        
10   599105 2019-01-01 00:45:00 2019-01-01 10:11:00 ตราด        Trat            
# ℹ 81,366 more rows
# ℹ 15 more variables: agency &lt;chr&gt;, route &lt;chr&gt;, vehicle_type &lt;chr&gt;,
#   presumed_cause &lt;chr&gt;, accident_type &lt;chr&gt;,
#   number_of_vehicles_involved &lt;dbl&gt;, number_of_fatalities &lt;dbl&gt;,
#   number_of_injuries &lt;dbl&gt;, weather_condition &lt;chr&gt;, road_description &lt;chr&gt;,
#   slope_description &lt;chr&gt;, Month &lt;ord&gt;, dayofweek &lt;int&gt;, Month_fac &lt;dbl&gt;,
#   geometry &lt;POINT [m]&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get descriptions on types of data types</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'presumed_cause'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "presumed_cause"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(rdacc_df<span class="sc">$</span>presumed_cause)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "driving under the influence of alcohol"         
 [2] "speeding"                                       
 [3] "cutting in closely by people/vehicles/animals"  
 [4] "failure to yield right of way"                  
 [5] "failure to yield/signal"                        
 [6] "falling asleep"                                 
 [7] "running red lights/traffic signals"             
 [8] "other"                                          
 [9] "unfamiliarity with the route/unskilled driving" 
[10] "vehicle equipment failure"                      
[11] "illegal overtaking"                             
[12] "tailgating"                                     
[13] "ignoring stop sign while leaving intersection"  
[14] "overloaded vehicle"                             
[15] "insufficient light"                             
[16] "disabled vehicle without proper signals"        
[17] "abrupt lane change"                             
[18] "debris/obstruction on the road"                 
[19] "reversing vehicle"                              
[20] "brake/anti-lock brake system failure"           
[21] "medical condition"                              
[22] "vehicle electrical system failure"              
[23] "driving in the wrong lane"                      
[24] "straddling lanes"                               
[25] "dangerous curve"                                
[26] "failure to signal enter/exit parking"           
[27] "slippery road"                                  
[28] "no traffic signs"                               
[29] "sudden stop"                                    
[30] "using mobile phone while driving"               
[31] "driving without headlights/illumination"        
[32] "worn-out/tire blowout"                          
[33] "obstruction in sight"                           
[34] "traffic light system failure"                   
[35] "disabled vehicle without proper signals/signs"  
[36] "narrow road"                                    
[37] "turn signal system failure"                     
[38] "navigation equipment failure"                   
[39] "inadequate visibility"                          
[40] "road in poor condition"                         
[41] "ป้ายจราจรชำรุด"                                   
[42] "เส้นแบ่งทิศทางจราจรชำรุด"                           
[43] "repair/construction on the road"                
[44] "no presumed cause related to driver"            
[45] "external disturbance"                           
[46] "no presumed cause related to vehicle conditions"
[47] "no presumed cause related to road conditions"   
[48] "no road divider lines"                          
[49] "loss of control"                                
[50] "using psychoactive substances"                  
[51] "no traffic light system"                        
[52] "aggressive driving/overtaking"                  
[53] "internal disturbance"                           
[54] "มึนเมาจากแอลกอฮอล์"                               </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'number_of_fatalities'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "number_of_fatalities"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(rdacc_df<span class="sc">$</span>number_of_fatalities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  0  1  3  2  5  6  9  4 10  7 11 13  8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'weather_condition'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "weather_condition"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(rdacc_df<span class="sc">$</span>road_description)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "straight road"                       
 [2] "wide curve"                          
 [3] "other"                               
 [4] "connecting to public/commercial area"
 [5] "sharp curve"                         
 [6] "four-way intersection"               
 [7] "connecting to private area"          
 [8] "t-intersection"                      
 [9] "y-intersection"                      
[10] "grade-separated intersection/ramps"  
[11] "merge lane"                          
[12] "connecting to school area"           
[13] "lane-changing area"                  
[14] "u-turn area"                         
[15] "roundabout"                          
[16] "motorcycle lane"                     
[17] "pedestrian path"                     
[18] "bridge (across river/canal)"         
[19] "zebra crossing/pedestrian crossing"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'weather_condition'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "weather_condition"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(rdacc_df<span class="sc">$</span>weather_condition)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "clear"            "foggy"            "dark"             "rainy"           
[5] "other"            "natural disaster" "land slide"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'vehicle_type'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "vehicle_type"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(rdacc_df<span class="sc">$</span>vehicle_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "motorcycle"                   "private/passenger car"       
 [3] "4-wheel pickup truck"         "other"                       
 [5] "motorized tricycle"           "large truck with trailer"    
 [7] "van"                          "6-wheel truck"               
 [9] "7-10-wheel truck"             "bicycle"                     
[11] "passenger pickup truck"       "pedestrian"                  
[13] "large passenger vehicle"      "tractor/agricultural vehicle"
[15] "three-wheeled vehicle"       </code></pre>
</div>
</div>
<p>May need to bin certain data into smaller bits so as to draw conclusions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>rdacc_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(rdacc_sf)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rdacc_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "acc_code"                    "incident_datetime"          
 [3] "report_datetime"             "province_th"                
 [5] "province_en"                 "agency"                     
 [7] "route"                       "vehicle_type"               
 [9] "presumed_cause"              "accident_type"              
[11] "number_of_vehicles_involved" "number_of_fatalities"       
[13] "number_of_injuries"          "weather_condition"          
[15] "road_description"            "slope_description"          
[17] "Month"                       "dayofweek"                  
[19] "Month_fac"                   "geometry"                   </code></pre>
</div>
</div>
<p>Read the road data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>thai_rl_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data"</span>, <span class="at">layer =</span> <span class="st">"hotosm_tha_roads_lines_shp"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">st_set_crs</span>(<span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">32647</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `hotosm_tha_roads_lines_shp' from data source 
  `C:\Users\Admin\Desktop\SMU\ISSS626\ISSS626-KierenChua\TakeHomeEx\TakeHomeEx01\data' 
  using driver `ESRI Shapefile'
Simple feature collection with 2792590 features and 14 fields
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: 97.34457 ymin: 5.643645 xmax: 105.6528 ymax: 20.47168
CRS:           NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>thai_rl_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 2792590 features and 14 fields
Geometry type: MULTILINESTRING
Dimension:     XY
Bounding box:  xmin: 325313.7 ymin: 624248.4 xmax: 1215576 ymax: 2263968
Projected CRS: WGS 84 / UTM zone 47N
First 10 features:
             name               name_en        highway  surface smoothness
1      ถนนฉลองกรุง    Chalong Krung Road      secondary    paved       &lt;NA&gt;
2  ซอยฉลองกรุง 1/1 Soi Chalong Krung 1/1    residential     &lt;NA&gt;       &lt;NA&gt;
3            &lt;NA&gt;                  &lt;NA&gt; secondary_link     &lt;NA&gt;       &lt;NA&gt;
4            &lt;NA&gt;                  &lt;NA&gt;        service     &lt;NA&gt;       &lt;NA&gt;
5      ถนนฉลองกรุง    Chalong Krung Road      secondary concrete       &lt;NA&gt;
6            &lt;NA&gt;                  &lt;NA&gt;        service     &lt;NA&gt;       &lt;NA&gt;
7     ถนนเอราวัณ 1         Erawan 1 Road       tertiary     &lt;NA&gt;       &lt;NA&gt;
8            &lt;NA&gt;                  &lt;NA&gt;           path  unpaved       &lt;NA&gt;
9            &lt;NA&gt;                  &lt;NA&gt;        service     &lt;NA&gt;       &lt;NA&gt;
10           &lt;NA&gt;                  &lt;NA&gt;    residential     &lt;NA&gt;       &lt;NA&gt;
   width lanes oneway bridge layer source        name_th     osm_id  osm_type
1   &lt;NA&gt;  &lt;NA&gt;    yes   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;     ถนนฉลองกรุง 1125681229 ways_line
2   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt; ซอยฉลองกรุง 1/1  594401607 ways_line
3   &lt;NA&gt;  &lt;NA&gt;    yes   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;           &lt;NA&gt;  472283206 ways_line
4   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;           &lt;NA&gt;  594401608 ways_line
5   &lt;NA&gt;     2    yes    yes     1   Bing     ถนนฉลองกรุง  116847248 ways_line
6   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;           &lt;NA&gt;  317485095 ways_line
7   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;    ถนนเอราวัณ 1  378672881 ways_line
8   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;    GPS           &lt;NA&gt; 1238351123 ways_line
9   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;           &lt;NA&gt;  909942692 ways_line
10  &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;           &lt;NA&gt;  694824299 ways_line
                         geometry
1  MULTILINESTRING ((693686.1 ...
2  MULTILINESTRING ((693358 15...
3  MULTILINESTRING ((692949.1 ...
4  MULTILINESTRING ((693256 15...
5  MULTILINESTRING ((692810.8 ...
6  MULTILINESTRING ((693877.2 ...
7  MULTILINESTRING ((677182.3 ...
8  MULTILINESTRING ((486572.6 ...
9  MULTILINESTRING ((629009.2 ...
10 MULTILINESTRING ((629703.9 ...</code></pre>
</div>
</div>
<p>We are only interested in the Thai Metro Area, so need to read the boundaries from the boundary data and filter there</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read from the province layer, note that the Thai Metro area contains only</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bangkok</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nonthaburi</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nakhon Pathom</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pathum Thani</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Samut Prakan</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Samut Sakhon</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>thai_boundaries <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data"</span>, <span class="at">layer =</span> <span class="st">"tha_admbnda_adm1_rtsd_20220121"</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">32647</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `tha_admbnda_adm1_rtsd_20220121' from data source 
  `C:\Users\Admin\Desktop\SMU\ISSS626\ISSS626-KierenChua\TakeHomeEx\TakeHomeEx01\data' 
  using driver `ESRI Shapefile'
Simple feature collection with 77 features and 16 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</section>
<section id="part-2-split-by-location" class="level2">
<h2 class="anchored" data-anchor-id="part-2-split-by-location">Part 2 : Split by location</h2>
<p>Since the regions only contains the said regions, we can split it down to the regions for better data processing speed. Said locations are</p>
<ol type="1">
<li>Bangkok</li>
<li>Nonthaburi</li>
<li>Nakhon Pathom</li>
<li>Pathum Thani</li>
<li>Samut Prakan</li>
<li>Samut Sakhon</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the thai boundaries by said locations</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>selected_location_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Bangkok'</span>, <span class="st">'Nonthaburi'</span>, <span class="st">'Nakhon Pathom'</span>, <span class="st">'Pathum Thani'</span>, <span class="st">'Samut Prakan'</span>, <span class="st">'Samut Sakhon'</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>selected_thai_boundaries <span class="ot">&lt;-</span> thai_boundaries[thai_boundaries<span class="sc">$</span>ADM1_EN <span class="sc">%in%</span> selected_location_list,]</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(selected_thai_boundaries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: plotting the first 9 out of 16 attributes; use max.plot = 16 to plot
all</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Make sure that the other locations are also confined to the selected locations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>combined_geometry <span class="ot">&lt;-</span> <span class="fu">st_union</span>(selected_thai_boundaries)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(combined_geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Geometry set for 1 feature 
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 587893.5 ymin: 1484414 xmax: 712440.5 ymax: 1579076
Projected CRS: WGS 84 / UTM zone 47N</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>POLYGON ((706774.2 1542625, 706774.2 1542619, 7...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(combined_geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter by this combined geometry</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>contains_combined <span class="ot">&lt;-</span> <span class="fu">st_within</span>(rdacc_sf, combined_geometry, <span class="at">sparse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>contains_combined <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rdacc_sf), <span class="cf">function</span>(i) {</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">any</span>(contains_combined[[i]])</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_sf <span class="ot">&lt;-</span> rdacc_sf[contains_combined, ]</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(filtered_rdacc_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: plotting the first 9 out of 19 attributes; use max.plot = 19 to plot
all</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see that there is a cluster in the reporting datetime and the incident datetime. But since the report and incident datetime is so similar there could be a relation. There seems to be also a cluster in presumed cause in roughly the same area.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now filter the roadlines as well</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Cut down thai_rl_sf to be smaller for easier processing remove unecesarry columns</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Smoothness infer from surface, source, width, oneway,layer</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>cut_rl_sf <span class="ot">&lt;-</span> thai_rl_sf <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>surface, <span class="sc">-</span>source, </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="sc">-</span>name, <span class="sc">-</span>name_en, <span class="sc">-</span>name_th,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="sc">-</span>width, <span class="sc">-</span>oneway, <span class="sc">-</span>layer,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="sc">-</span>osm_id, <span class="sc">-</span>osm_type)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop Rows with special names that do not concern us,</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Only include Roads and link roads</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>cut_rl_sf <span class="ot">&lt;-</span> cut_rl_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(highway <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"motorway"</span>, <span class="st">"trunk"</span>, <span class="st">"primary"</span>, <span class="st">"secondary"</span>, <span class="st">"tertiary"</span>, <span class="st">"unclassified"</span>, <span class="st">"residential"</span>, <span class="st">"service"</span>, <span class="st">"motorway_link"</span>, <span class="st">"trunk_link"</span>, <span class="st">"primary_link"</span>, <span class="st">"secondary_link"</span>, <span class="st">"motorway_junction"</span>))</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Make new geometry, centerpoint of road so that comparison for st_within is easier later</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Dont have to compare all points in mutli-line, just see the center</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>cut_rl_sf<span class="sc">$</span>centroid <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(cut_rl_sf<span class="sc">$</span>geometry)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(cut_rl_sf<span class="sc">$</span>centroid))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for geometry</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>contains_rl <span class="ot">&lt;-</span> <span class="fu">st_within</span>(cut_rl_sf<span class="sc">$</span>centroid, combined_geometry, <span class="at">sparse =</span> <span class="cn">FALSE</span>, <span class="at">prepared=</span><span class="cn">TRUE</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>contains_rl <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(cut_rl_sf), <span class="cf">function</span>(i) {</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">any</span>(contains_rl[[i]])</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>filtered_thai_rl_sf <span class="ot">&lt;-</span> cut_rl_sf[contains_rl, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-3-saving-the-smaller-files" class="level2">
<h2 class="anchored" data-anchor-id="part-3-saving-the-smaller-files">Part 3 : Saving the Smaller Files</h2>
<p>The roadlines data is ver big, so saving to a smaller size file as a .rds file is advised</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(filtered_thai_rl_sf, <span class="at">file=</span><span class="st">'data/clean_data/filtered_thai_rl_sf.rds'</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(filtered_rdacc_sf, <span class="at">file=</span><span class="st">'data/clean_data/filtered_rdacc_sf.rds'</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(selected_thai_boundaries, <span class="at">file=</span><span class="st">'data/clean_data/selected_thai_boundaries.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-4-read-the-new-file" class="level2">
<h2 class="anchored" data-anchor-id="part-4-read-the-new-file">Part 4 : Read the new file</h2>
<p>Now we can try to read the files again so that we can access the new data This also gives us an estimate of how long it will take to process the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>filtered_thai_rl_sf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'data/clean_data/filtered_thai_rl_sf.rds'</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_sf <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'data/clean_data/filtered_rdacc_sf.rds'</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>filtered_thai_bd <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'data/clean_data/selected_thai_boundaries.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-4-plot-all-graphs-together-for-visual-prelimnary-analysis" class="level2">
<h2 class="anchored" data-anchor-id="part-4-plot-all-graphs-together-for-visual-prelimnary-analysis">Part 4 : Plot all graphs together for visual prelimnary analysis’</h2>
<p>Use tmaps, but split by area</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(filtered_thai_rl_sf) <span class="sc">+</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">col =</span> <span class="st">"highway"</span>) <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(filtered_rdacc_sf) <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"presumed_cause"</span>, <span class="at">shape =</span> <span class="st">"accident_type"</span>) <span class="sc">+</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">"Visual Preliminary Analysis"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Number of levels of the variable "presumed_cause" is 40, which is
larger than max.categories (which is 30), so levels are combined. Set
tmap_options(max.categories = 40) in the layer function to show all levels.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Number of levels (unique values) is 11, which is larger than number of
symbol shapes (5).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Some legend labels were too wide. These labels have been resized to 0.34, 0.33. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Accidents seems to happen mostly on highways, with a few residential scattered, possible to remove some types of highways such as service.</p>
<p>Seems from the main view that accidents happend among main roads / highways. Can try lixelize to find column</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-5-1st-and-2nd-order-analysis-of-road-accidents" class="level2">
<h2 class="anchored" data-anchor-id="part-5-1st-and-2nd-order-analysis-of-road-accidents">Part 5 : 1st and 2nd Order Analysis of Road Accidents</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confine geometry to OWIN </span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>filtered_thai_bd_owin <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(filtered_thai_bd)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(filtered_thai_bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: plotting the first 9 out of 16 attributes; use max.plot = 16 to plot
all</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn points into PPP</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp <span class="ot">&lt;-</span> <span class="fu">as.ppp</span>(filtered_rdacc_sf<span class="sc">$</span>geometry)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp <span class="ot">&lt;-</span> filtered_rdacc_ppp[filtered_thai_bd_owin]</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp.km <span class="ot">&lt;-</span> <span class="fu">rescale.ppp</span>(filtered_rdacc_ppp, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(filtered_rdacc_ppp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="check-1st-order-and-view" class="level3">
<h3 class="anchored" data-anchor-id="check-1st-order-and-view">Check 1st Order and View</h3>
<p>We can try to do first order spatial analysis to see if there are any clusters</p>
<section id="initial-overall-view" class="level4">
<h4 class="anchored" data-anchor-id="initial-overall-view">Initial Overall View</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use 1km as fixed bandwith</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_bw <span class="ot">&lt;-</span> <span class="fu">density</span>(filtered_rdacc_ppp.km,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sigma=</span><span class="fl">1.0</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">edge=</span><span class="cn">TRUE</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">kernel=</span><span class="st">"gaussian"</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(filtered_rdacc_bw)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(filtered_thai_bd<span class="sc">$</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Seems like accidents are clustered to within certain stretches of highway and also near intersections.</p>
<p>We can also try to filter by day to determine if the working days affect</p>
</section>
<section id="split-by-district" class="level4">
<h4 class="anchored" data-anchor-id="split-by-district">Split by District</h4>
<p>Filter by district 1) Bangkok 2) Nonthaburi 3) Nakhon Pathom 4) Pathum Thani 5) Samut Prakan 6) Samut Sakhon</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>bk <span class="ot">&lt;-</span> filtered_rdacc_sf <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province_en <span class="sc">==</span> <span class="st">"Bangkok"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>non <span class="ot">&lt;-</span> filtered_rdacc_sf <span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province_en <span class="sc">==</span> <span class="st">"Nonthaburi"</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> filtered_rdacc_sf <span class="sc">%&gt;%</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province_en <span class="sc">==</span> <span class="st">"Nakhon Pathom"</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span> filtered_rdacc_sf <span class="sc">%&gt;%</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province_en <span class="sc">==</span> <span class="st">"Pathum Thani"</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> filtered_rdacc_sf <span class="sc">%&gt;%</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province_en <span class="sc">==</span> <span class="st">"Samut Prakan"</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> filtered_rdacc_sf <span class="sc">%&gt;%</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province_en <span class="sc">==</span> <span class="st">"Samut Sakhon"</span>)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter by Location</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>bk_owin <span class="ot">&lt;-</span> filtered_thai_bd <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ADM1_EN<span class="sc">==</span><span class="st">"Bangkok"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.owin</span>()</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>non_owin <span class="ot">&lt;-</span> filtered_thai_bd <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ADM1_EN<span class="sc">==</span><span class="st">"Nonthaburi"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.owin</span>()</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>np_owin <span class="ot">&lt;-</span> filtered_thai_bd <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ADM1_EN<span class="sc">==</span><span class="st">"Nakhon Pathom"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.owin</span>()</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>pt_owin <span class="ot">&lt;-</span> filtered_thai_bd <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ADM1_EN<span class="sc">==</span><span class="st">"Pathum Thani"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.owin</span>()</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>sp_owin <span class="ot">&lt;-</span> filtered_thai_bd <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ADM1_EN<span class="sc">==</span><span class="st">"Samut Prakan"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.owin</span>()</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>ss_owin <span class="ot">&lt;-</span> filtered_thai_bd <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ADM1_EN<span class="sc">==</span><span class="st">"Samut Sakhon"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.owin</span>()</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the graphs</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp_bk <span class="ot">&lt;-</span> filtered_rdacc_ppp[bk_owin]</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp_non <span class="ot">&lt;-</span> filtered_rdacc_ppp[non_owin]</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp_np <span class="ot">&lt;-</span> filtered_rdacc_ppp[np_owin]</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp_pt <span class="ot">&lt;-</span> filtered_rdacc_ppp[pt_owin]</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp_sp <span class="ot">&lt;-</span> filtered_rdacc_ppp[sp_owin]</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp_ss <span class="ot">&lt;-</span> filtered_rdacc_ppp[ss_owin]</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp_bk.km <span class="ot">&lt;-</span> <span class="fu">rescale.ppp</span>(filtered_rdacc_ppp_bk, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp_non.km <span class="ot">&lt;-</span> <span class="fu">rescale.ppp</span>(filtered_rdacc_ppp_non, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp_np.km <span class="ot">&lt;-</span> <span class="fu">rescale.ppp</span>(filtered_rdacc_ppp_np, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp_pt.km <span class="ot">&lt;-</span> <span class="fu">rescale.ppp</span>(filtered_rdacc_ppp_pt, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp_sp.km <span class="ot">&lt;-</span> <span class="fu">rescale.ppp</span>(filtered_rdacc_ppp_sp, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_ppp_ss.km <span class="ot">&lt;-</span> <span class="fu">rescale.ppp</span>(filtered_rdacc_ppp_ss, <span class="dv">1000</span>, <span class="st">"km"</span>)</span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(filtered_rdacc_ppp_bk.km, <span class="at">main=</span><span class="st">"Bangkok"</span>)</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(filtered_rdacc_ppp_non.km , <span class="at">main=</span><span class="st">"Nonthaburi"</span>)</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(filtered_rdacc_ppp_np.km, <span class="at">main=</span><span class="st">"Nakhon Pathom"</span>)</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(filtered_rdacc_ppp_pt.km , <span class="at">main=</span><span class="st">"Pathum Thani"</span>)</span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(filtered_rdacc_ppp_sp.km, <span class="at">main=</span><span class="st">"Samut Prakan"</span>)</span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(filtered_rdacc_ppp_ss.km, <span class="at">main=</span><span class="st">"Samut Sakhon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(filtered_rdacc_ppp_bk.km, </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">sigma=</span><span class="fl">0.25</span>, </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">edge=</span><span class="cn">TRUE</span>, </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">kernel=</span><span class="st">"gaussian"</span>),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Bangkok"</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(filtered_rdacc_ppp_non.km, </span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">sigma=</span><span class="fl">0.25</span>, </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">edge=</span><span class="cn">TRUE</span>, </span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">kernel=</span><span class="st">"gaussian"</span>),</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Nonthaburi"</span>)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(filtered_rdacc_ppp_np.km, </span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">sigma=</span><span class="fl">0.25</span>, </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">edge=</span><span class="cn">TRUE</span>, </span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">kernel=</span><span class="st">"gaussian"</span>),</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Nakhon Pathom"</span>)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(filtered_rdacc_ppp_pt.km, </span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">sigma=</span><span class="fl">0.25</span>, </span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">edge=</span><span class="cn">TRUE</span>, </span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">kernel=</span><span class="st">"gaussian"</span>),</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Pathum Thani"</span>)</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(filtered_rdacc_ppp_sp.km, </span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">sigma=</span><span class="fl">0.25</span>, </span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">edge=</span><span class="cn">TRUE</span>, </span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">kernel=</span><span class="st">"gaussian"</span>),</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Samut Prakan"</span>)</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(filtered_rdacc_ppp_ss.km, </span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">sigma=</span><span class="fl">0.25</span>, </span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">edge=</span><span class="cn">TRUE</span>, </span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">kernel=</span><span class="st">"gaussian"</span>),</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Samut Sakhon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="part-6-check-network-constrained-by-time" class="level2">
<h2 class="anchored" data-anchor-id="part-6-check-network-constrained-by-time">Part 6 : Check Network constrained by Time</h2>
<p>Now that we can see that there are clusters, we can put it in numbers by doing lixelizing to gain new insight by time instead of road conditions as specified in the task.</p>
<section id="convert-to-linestring" class="level3">
<h3 class="anchored" data-anchor-id="convert-to-linestring">Convert to LineString</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cast the multi-line to linestring</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filtered_thai_rl_sf$line_string &lt;- st_cast(filtered_thai_rl_sf$geometry, "LINESTRING")</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>filtered_thai_rl_sf_linestring <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(filtered_thai_rl_sf, <span class="st">"LINESTRING"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in st_cast.sf(filtered_thai_rl_sf, "LINESTRING"): repeating attributes
for all sub-geometries for which they may not be constant</code></pre>
</div>
</div>
</section>
<section id="additional-filtering" class="level3">
<h3 class="anchored" data-anchor-id="additional-filtering">Additional Filtering</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the unecessary roads</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>filtered_thai_rl_sf_linestring <span class="ot">&lt;-</span> filtered_thai_rl_sf_linestring <span class="sc">%&gt;%</span> <span class="fu">filter</span>(highway <span class="sc">!=</span> <span class="st">'service'</span>) <span class="sc">%&gt;%</span>      <span class="fu">filter</span>(highway <span class="sc">!=</span> <span class="st">'unclassified'</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(highway <span class="sc">!=</span> <span class="st">'residential'</span>) </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>filtered_thai_rl_sf_linestring</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 25124 features and 4 fields
Active geometry column: geometry
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: 589656.1 ymin: 1486975 xmax: 711950.2 ymax: 1584791
Projected CRS: WGS 84 / UTM zone 47N
First 10 features:
          highway smoothness lanes bridge                 centroid
1       secondary       &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt; POINT (693431.4 1519383)
2  secondary_link       &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt; POINT (693051.7 1518971)
3       secondary       &lt;NA&gt;     2    yes POINT (692955.8 1518812)
4        tertiary       &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt; POINT (677238.5 1560536)
5       secondary       &lt;NA&gt;     3   &lt;NA&gt; POINT (676974.2 1542847)
6       secondary       &lt;NA&gt;     3   &lt;NA&gt; POINT (676974.6 1542834)
7       secondary       &lt;NA&gt;     3   &lt;NA&gt; POINT (676399.8 1542915)
8       secondary       &lt;NA&gt;     3   &lt;NA&gt; POINT (676310.5 1542908)
9           trunk       &lt;NA&gt;     3   &lt;NA&gt; POINT (633428.1 1523774)
10       tertiary       &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;   POINT (668233 1522120)
                         geometry
1  LINESTRING (693686.1 151979...
2  LINESTRING (692949.1 151886...
3  LINESTRING (692810.8 151863...
4  LINESTRING (677182.3 156542...
5  LINESTRING (676813.7 154284...
6  LINESTRING (677134.2 154283...
7  LINESTRING (675989.4 154300...
8  LINESTRING (676815 1542831,...
9  LINESTRING (632625.1 152356...
10 LINESTRING (668360.2 152245...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop uncessary non-discernable types or those caused by natural disasters</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_sf <span class="ot">&lt;-</span> filtered_rdacc_sf <span class="sc">%&gt;%</span> <span class="fu">filter</span>(weather_condition <span class="sc">!=</span> <span class="st">"landslide"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(accident_type <span class="sc">!=</span> <span class="st">"other"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(vehicle_type <span class="sc">!=</span> <span class="st">"other"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="time-and-size-based-additions" class="level3">
<h3 class="anchored" data-anchor-id="time-and-size-based-additions">Time and size based additions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(filtered_rdacc_sf<span class="sc">$</span>vehicle_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "motorcycle"                   "private/passenger car"       
 [3] "4-wheel pickup truck"         "van"                         
 [5] "large truck with trailer"     "large passenger vehicle"     
 [7] "6-wheel truck"                "7-10-wheel truck"            
 [9] "passenger pickup truck"       "motorized tricycle"          
[11] "pedestrian"                   "bicycle"                     
[13] "tractor/agricultural vehicle"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add new column that describes the day of the week (Monday, Tuesday..)</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_sf<span class="sc">$</span>dayofweek_name <span class="ot">&lt;-</span> <span class="fu">wday</span>(filtered_rdacc_sf<span class="sc">$</span>incident_datetime, <span class="at">label=</span><span class="cn">TRUE</span>, <span class="at">abbr=</span><span class="cn">FALSE</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add new column that describes time of day, split into morning(700am - 12pm), afternoon (12pm - 5pm), evening (5pm - 10pm), night (10pm - 5am)</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>classify_time_period <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  hour <span class="ot">&lt;-</span> <span class="fu">hour</span>(dt)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (hour <span class="sc">&gt;=</span> <span class="dv">7</span> <span class="sc">&amp;&amp;</span> hour <span class="sc">&lt;</span> <span class="dv">12</span>) {</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Morning"</span>)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (hour <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;&amp;</span> hour <span class="sc">&lt;</span> <span class="dv">17</span>) {</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Afternoon"</span>)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (hour <span class="sc">&gt;=</span> <span class="dv">17</span> <span class="sc">&amp;&amp;</span> hour <span class="sc">&lt;</span> <span class="dv">22</span>) {</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Evening"</span>)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Night"</span>)</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="co"># I am seperating the vehicle based on size of blind spot</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>classify_vehicle <span class="ot">&lt;-</span> <span class="cf">function</span>(dt) {</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>  small_vehicle <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"motorcycle"</span>, <span class="st">"bicycle"</span>, <span class="st">"motorized tricycle"</span>)</span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>  medium_vehicle <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"passenger pickup truck"</span>, <span class="st">"private/passenger car"</span>, <span class="st">"large passenger vehicle"</span>, <span class="st">"4-wheel pickup truck"</span>)</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (dt <span class="sc">%in%</span> small_vehicle) {</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Small"</span>)</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (dt <span class="sc">%in%</span> medium_vehicle) {</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Medium"</span>)</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Large"</span>)</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_sf <span class="ot">&lt;-</span> filtered_rdacc_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="st">"time_of_day"</span> <span class="ot">=</span> <span class="fu">sapply</span>(filtered_rdacc_sf<span class="sc">$</span>incident_datetime, classify_time_period))</span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Classify vehicles into small, medium and large vehicles based on function above</span></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>filtered_rdacc_sf <span class="ot">&lt;-</span> filtered_rdacc_sf <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="st">"vehicle_class"</span> <span class="ot">=</span> <span class="fu">sapply</span>(filtered_rdacc_sf<span class="sc">$</span>vehicle_type, classify_vehicle))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="histogram-analysis" class="level3">
<h3 class="anchored" data-anchor-id="histogram-analysis">Histogram Analysis</h3>
<p>We can get a rough overview on the accidents by having a count</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-width: 100</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(filtered_rdacc_sf, <span class="fu">aes</span>(<span class="at">x =</span> time_of_day)) <span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of accident by Time of Day"</span>, <span class="at">x =</span> <span class="st">"Time of Day"</span>, <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(filtered_rdacc_sf, <span class="fu">aes</span>(<span class="at">x =</span> dayofweek_name)) <span class="sc">+</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of accident by Day of Week"</span>, <span class="at">x =</span> <span class="st">"Day of Week"</span>, <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-25-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(filtered_rdacc_sf, <span class="fu">aes</span>(<span class="at">x =</span> vehicle_class)) <span class="sc">+</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of accident by vehicle_class"</span>, <span class="at">x =</span> <span class="st">"vehicle_class"</span>, <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-25-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="finding-bandwidths-using-k-function" class="level3">
<h3 class="anchored" data-anchor-id="finding-bandwidths-using-k-function">Finding bandwidths using K-Function</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a table for accident types and by district to reduce size of the the network</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co">#unique_locs &lt;- unique(filtered_thai_bd$ADM1_EN)</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>unique_tod <span class="ot">&lt;-</span> <span class="fu">unique</span>(filtered_rdacc_sf<span class="sc">$</span>time_of_day)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>unique_dow <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Monday"</span>, <span class="st">"Tuesday"</span>, <span class="st">"Wednesday"</span>, <span class="st">"Thursday"</span>, <span class="st">"Friday"</span>, <span class="st">"Saturday"</span>, <span class="st">"Sunday"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample 1 graph to initialize an suitable starting bw</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>loc_rdacc_sf <span class="ot">&lt;-</span> filtered_rdacc_sf <span class="sc">%&gt;%</span> </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time_of_day <span class="sc">==</span> unique_tod[<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dayofweek_name <span class="sc">==</span> unique_dow[<span class="dv">1</span>])</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>kfun_rdacc <span class="ot">&lt;-</span> <span class="fu">kfunctions</span>(filtered_thai_rl_sf_linestring, </span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>                           loc_rdacc_sf,</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">start =</span> <span class="dv">0</span>, </span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">end =</span> <span class="dv">1000</span>, </span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>                           <span class="at">step =</span> <span class="dv">50</span>, </span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">width =</span> <span class="dv">50</span>, </span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nsim =</span> <span class="dv">50</span>, </span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">resolution =</span> <span class="dv">50</span>,</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">verbose =</span> <span class="cn">TRUE</span>, </span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>                            <span class="at">agg=</span> <span class="dv">200</span>,</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>                           <span class="at">conf_int =</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Preparing data ..."
[1] "Snapping points on lines ..."
[1] "Building graph ..."
[1] "Calculating k and g functions ..."
[1] "Calculating the simulations ..."

  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |================================================                      |  68%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |================================================================      |  92%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |===================================================================== |  98%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(kfun_rdacc<span class="sc">$</span>plotk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a dataframe to keep all the indexes</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>bw_dataframe <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(unique_tod), <span class="at">nrow =</span> <span class="fu">length</span>(unique_dow)))</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(bw_dataframe) <span class="ot">&lt;-</span> unique_tod</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(bw_dataframe) <span class="ot">&lt;-</span> unique_dow</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Since I cannot append dataframes to dataframes, will need to save indexes</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>count <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(unique_dow)) {</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(unique_tod)) {</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    bw_dataframe[unique_dow[i], unique_tod[j]] <span class="ot">&lt;-</span> count</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    count <span class="ot">&lt;-</span> count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>bw_dataframe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Night Morning Afternoon Evening
Monday        1       2         3       4
Tuesday       5       6         7       8
Wednesday     9      10        11      12
Thursday     13      14        15      16
Friday       17      18        19      20
Saturday     21      22        23      24
Sunday       25      26        27      28</code></pre>
</div>
</div>
</section>
<section id="lixelize-based-on-bandwidths" class="level3">
<h3 class="anchored" data-anchor-id="lixelize-based-on-bandwidths">Lixelize based on bandwidths</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>accidents_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">length</span>(unique_dow) <span class="sc">*</span> <span class="fu">length</span>(unique_tod)) <span class="co"># 2 cols</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>lixels_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">length</span>(unique_dow) <span class="sc">*</span> <span class="fu">length</span>(unique_tod))</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>appending_index <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for acciednt types</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(unique_dow)) {</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter the day</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(unique_tod)) {</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    loc_rdacc_sf <span class="ot">&lt;-</span> filtered_rdacc_sf <span class="sc">%&gt;%</span> </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(time_of_day <span class="sc">==</span> unique_tod[j]) <span class="sc">%&gt;%</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(dayofweek_name <span class="sc">==</span> unique_dow[i])</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Skip if no draw</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(loc_rdacc_sf) <span class="sc">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>    lixelized <span class="ot">&lt;-</span> <span class="fu">lixelize_lines.mc</span>(filtered_thai_rl_sf_linestring, </span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">1000</span>, </span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>                               <span class="at">mindist =</span> <span class="cn">NULL</span>)</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>    samples <span class="ot">&lt;-</span> <span class="fu">lines_center</span>(lixelized)</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>    densities <span class="ot">&lt;-</span> <span class="fu">nkde</span>(filtered_thai_rl_sf_linestring, </span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">events =</span> loc_rdacc_sf,</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(loc_rdacc_sf)),</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">samples =</span> samples,</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">kernel_name =</span> <span class="st">"quartic"</span>,</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">bw =</span> <span class="dv">300</span>, </span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">div=</span> <span class="st">"bw"</span>, </span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">method =</span> <span class="st">"simple"</span>,</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">digits =</span> <span class="dv">3</span>, </span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tol =</span> <span class="dv">1</span>,</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">grid_shape =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), </span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">max_depth =</span> <span class="dv">5</span>,</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>                      <span class="at">agg =</span> <span class="dv">5</span>, </span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sparse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>                      <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>    samples<span class="sc">$</span>density <span class="ot">&lt;-</span> densities</span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>    lixelized<span class="sc">$</span>density <span class="ot">&lt;-</span> densities</span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>    samples<span class="sc">$</span>density <span class="ot">&lt;-</span> samples<span class="sc">$</span>density<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>    lixelized<span class="sc">$</span>density <span class="ot">&lt;-</span> lixelized<span class="sc">$</span>density<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append the values to the dataframe</span></span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(appending_index)</span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>    accidents_list[[appending_index]] <span class="ot">&lt;-</span> loc_rdacc_sf</span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>    lixels_list[[appending_index]] <span class="ot">&lt;-</span> lixelized</span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>    appending_index <span class="ot">&lt;-</span> appending_index <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1
[1] 2
[1] 3
[1] 4
[1] 5
[1] 6
[1] 7
[1] 8
[1] 9
[1] 10
[1] 11
[1] 12
[1] 13
[1] 14
[1] 15
[1] 16
[1] 17
[1] 18
[1] 19
[1] 20
[1] 21
[1] 22
[1] 23
[1] 24
[1] 25
[1] 26
[1] 27
[1] 28</code></pre>
</div>
</div>
</section>
<section id="plot-graphs-by-name" class="level3">
<h3 class="anchored" data-anchor-id="plot-graphs-by-name">Plot Graphs By Name</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-width: 12</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-height: 20</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the plots</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>tmap mode set to plotting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>map_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(unique_dow)) {</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(unique_tod)) {</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the index</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    cur_index <span class="ot">&lt;-</span> bw_dataframe[unique_dow[i], unique_tod[j]]</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(cur_index)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    set_title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(unique_dow[i], <span class="st">" on "</span>, unique_tod[j])</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>    map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(lixels_list[[cur_index]])<span class="sc">+</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tm_lines</span>(<span class="at">col=</span><span class="st">"highway"</span>, <span class="at">lwd=</span><span class="st">"density"</span>, <span class="at">scale=</span><span class="fl">6.0</span>) <span class="sc">+</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tm_shape</span>(accidents_list[[cur_index]])<span class="sc">+</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tm_dots</span>(<span class="at">col=</span><span class="st">"vehicle_class"</span>) <span class="sc">+</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tm_layout</span>(<span class="at">title =</span> set_title)</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(map)</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>    map_list[[cur_index]] <span class="ot">&lt;-</span> map</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Legend labels were too wide. Therefore, legend.text.size has been set to 0.62. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-18.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-19.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-20.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-21.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 22</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-22.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 23</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-23.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Legend labels were too wide. Therefore, legend.text.size has been set to 0.62. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-24.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-25.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 26</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-26.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 27</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-27.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 28</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TakeHomeEx01_files/figure-html/unnamed-chunk-30-28.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="part-7-final-analysis" class="level2">
<h2 class="anchored" data-anchor-id="part-7-final-analysis">Part 7 : Final Analysis</h2>
<p>Based on the histogram, we can see that more accidents happen during the night where it is possible. More accidents also happen during Friday and Saturday, Possibly due to it being the nights where people drive late and do not have to go to work tomorrow.</p>
<p>Most accidents are happening on motorways, according to the graphs. This is also backed up by the kernel analysis in part 4 where the regions of high density also correlate with the high network kernel density here. Most accidents happen at Kanchanaphisek Rd, roads connecting to Bang Khae Interchange, basically either motorways with long routes leading into Bangkok or Motorways with alot of exits to change into other highways.</p>
</section>
<section id="part-8-observations" class="level2">
<h2 class="anchored" data-anchor-id="part-8-observations">Part 8 : Observations</h2>
<p>It noted that more accidents happen with large vehicles in the afternoon and nights,while more accidents happen with medium sized vehicles during the morning and evening. This could correspond with rush hours where more people are going to or getting off from work during the morning and evening, where the number of personal vehicles on the road increases, therefore leading to more accidents during those periods</p>
<p>Another observation is that the majority of accidents are happening on motorways that are within the city area which are not linked via their train system. (I relied on Google Maps for this, I did not have time to find the appropriate data). If you do a side by side comparison, you can see that across all days and time periods excluding night, accidents do not occur commonly inside the populated zones and only happen on motorways that do not have any nearby adjacent train system. This result may be due to people taking the rail system more, therefore leading to less accidents. This hypothesis is further supported by observing the night time graphs, where accidents clusters begin to appear in the heavily populated regions when the train system is down for the night.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>